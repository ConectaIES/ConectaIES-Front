<div class="dashboard-container">
  <div class="header">
    <h1>
      Dashboard Administrativo
      @if (novasSolicitacoesCount() > 0) {
        <mat-icon [matBadge]="novasSolicitacoesCount()" matBadgeColor="warn" class="notification-icon">
          notifications_active
        </mat-icon>
      }
    </h1>

    <mat-form-field appearance="outline" class="filtro-ordenacao">
      <mat-label>Ordenar por</mat-label>
      <mat-select [value]="filtroOrdenacao()" (valueChange)="filtroOrdenacao.set($event)">
        <mat-option value="data">Data de Criação</mat-option>
        <mat-option value="tmr">Tempo para TMR</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  @if (carregando()) {
    <div class="loading">Carregando solicitações...</div>
  } @else if (solicitacoesOrdenadas().length === 0) {
    <mat-card class="empty-state">
      <mat-card-content>
        <mat-icon>check_circle</mat-icon>
        <p>Nenhuma solicitação pendente no momento.</p>
      </mat-card-content>
    </mat-card>
  } @else {
    <div class="solicitacoes-grid">
      @for (solicitacao of solicitacoesOrdenadas(); track solicitacao.id) {
        <mat-card 
          class="solicitacao-card" 
          [class.nova]="solicitacao.status === 'ABERTO' || solicitacao.status === 'NAO_VISTO'"
          [class]="getUrgenciaClass(solicitacao)"
          (click)="verDetalhes(solicitacao.id)"
        >
          <mat-card-header>
            <mat-card-title>{{ solicitacao.titulo }}</mat-card-title>
            <mat-card-subtitle>
              Protocolo: {{ solicitacao.protocolo }} | 
              Usuário: {{ solicitacao.usuarioNome }}
            </mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <div class="status-row">
              <mat-chip [highlighted]="true" [color]="getStatusColor(solicitacao.status)">
                {{ solicitacao.status }}
              </mat-chip>
              
              @if (solicitacao.timeToTmrBreach) {
                <span class="tmr-label" [class.urgente]="getUrgenciaClass(solicitacao) === 'urgente'">
                  {{ getTmrLabel(solicitacao) }}
                </span>
              }
            </div>

            <div class="info-row">
              <span class="data">{{ solicitacao.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>

            <p class="descricao">{{ solicitacao.descricao }}</p>
          </mat-card-content>

          <mat-card-actions>
            <button mat-button color="primary">
              <mat-icon>visibility</mat-icon>
              Visualizar e Responder
            </button>
          </mat-card-actions>
        </mat-card>
      }
    </div>
  }
</div>
