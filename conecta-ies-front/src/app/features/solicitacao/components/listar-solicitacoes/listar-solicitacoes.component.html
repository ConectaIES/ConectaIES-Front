<div class="listar-solicitacoes-container">
  <div class="header">
    <h1>Minhas Solicitações</h1>
    <button mat-raised-button color="primary" [matMenuTriggerFor]="menuSolicitacao">
      <mat-icon>add</mat-icon>
      Nova Solicitação
      <mat-icon>arrow_drop_down</mat-icon>
    </button>
    
    <mat-menu #menuSolicitacao="matMenu">
      <button mat-menu-item (click)="abrirFormulario('chamado')">
        <mat-icon>phone</mat-icon>
        <span>Chamado Personalizado</span>
      </button>
      <button mat-menu-item (click)="abrirFormulario('sugestao')">
        <mat-icon>lightbulb</mat-icon>
        <span>Sugestão de Melhoria</span>
      </button>
      <button mat-menu-item (click)="abrirFormulario('apoio')">
        <mat-icon>accessibility</mat-icon>
        <span>Solicitar Apoio</span>
      </button>
      <button mat-menu-item (click)="abrirFormulario('problema')">
        <mat-icon>warning</mat-icon>
        <span>Reportar Problema</span>
      </button>
    </mat-menu>
  </div>

  @if (carregando()) {
    <div class="loading">Carregando...</div>
  } @else if (solicitacoes().length === 0) {
    <mat-card class="empty-state">
      <mat-card-content>
        <p>Você ainda não possui solicitações.</p>
        <button mat-raised-button color="primary" [matMenuTriggerFor]="menuSolicitacao">
          <mat-icon>add</mat-icon>
          Criar Primeira Solicitação
          <mat-icon>arrow_drop_down</mat-icon>
        </button>
      </mat-card-content>
    </mat-card>
  } @else {
    <div class="solicitacoes-grid">
      @for (solicitacao of solicitacoes(); track solicitacao.id) {
        <mat-card class="solicitacao-card" (click)="verDetalhes(solicitacao.id)">
          <mat-card-header>
            <mat-card-title>{{ solicitacao.titulo }}</mat-card-title>
            <mat-card-subtitle>Protocolo: {{ solicitacao.protocolo }}</mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <div class="status-row">
              <mat-chip [highlighted]="true" [color]="getStatusColor(solicitacao.status)">
                {{ getStatusLabel(solicitacao.status) }}
              </mat-chip>
              <span class="data">{{ solicitacao.updatedAt | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
            <p class="descricao">{{ solicitacao.descricao }}</p>
          </mat-card-content>

          <mat-card-actions>
            <button mat-button color="primary">
              <mat-icon>visibility</mat-icon>
              Ver Detalhes
            </button>
          </mat-card-actions>
        </mat-card>
      }
    </div>
  }
</div>
