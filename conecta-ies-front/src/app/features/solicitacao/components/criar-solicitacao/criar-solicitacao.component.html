<div class="criar-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14,2 14,8 20,8"></polyline>
        <line x1="12" y1="18" x2="12" y2="12"></line>
        <line x1="9" y1="15" x2="15" y2="15"></line>
      </svg>
      <h1>Nova Solicitação de Assistência</h1>
    </div>
  </div>

  <!-- Form Content -->
  <div class="form-wrapper">
    <!-- Tipo Selection Cards -->
    <div class="tipo-selection">
      <h2 class="selection-title">Escolha o tipo de solicitação</h2>
      <div class="tipo-cards">
        @for (tipo of tiposSolicitacao; track tipo.value) {
          <div 
            class="tipo-card"
            [class.selected]="form.get('tipo')?.value === tipo.value"
            (click)="form.patchValue({ tipo: tipo.value })"
          >
            <div class="card-icon">
              @if (tipo.value === 'APOIO_LOCOMOCAO') {
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="5" r="3"></circle>
                  <path d="M6.5 8.5L9 11l-2 8 4-1 2 3"></path>
                  <path d="M13 11l3-3 4 2v3l-3 1"></path>
                </svg>
              } @else if (tipo.value === 'INTERPRETACAO_LIBRAS') {
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 12h6"></path>
                  <path d="M12 3v18"></path>
                  <path d="M5 12h.01"></path>
                  <path d="M19 12h.01"></path>
                  <circle cx="12" cy="12" r="10"></circle>
                </svg>
              } @else {
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                  <path d="m9 12 2 2 4-4"></path>
                </svg>
              }
            </div>
            <h3>{{ tipo.label }}</h3>
            <div class="check-indicator">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                <polyline points="20,6 9,17 4,12"></polyline>
              </svg>
            </div>
          </div>
        }
      </div>
      @if (form.get('tipo')?.hasError('required') && form.get('tipo')?.touched) {
        <p class="error-message">Por favor, selecione um tipo de solicitação</p>
      }
    </div>

    <!-- Form Card -->
    @if (form.get('tipo')?.value) {
      <div class="form-card">
        <form [formGroup]="form" (ngSubmit)="onSubmit()">
          <!-- Título -->
          <div class="form-group">
            <label class="form-label">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="4" y1="9" x2="20" y2="9"></line>
                <line x1="4" y1="15" x2="20" y2="15"></line>
                <line x1="10" y1="3" x2="8" y2="21"></line>
                <line x1="16" y1="3" x2="14" y2="21"></line>
              </svg>
              Título da Solicitação
            </label>
            <mat-form-field appearance="outline" class="custom-field">
              <input matInput formControlName="titulo" placeholder="Digite um título breve e descritivo" />
              @if (form.get('titulo')?.hasError('required')) {
                <mat-error>Título é obrigatório</mat-error>
              }
              @if (form.get('titulo')?.hasError('maxlength')) {
                <mat-error>Máximo de 200 caracteres</mat-error>
              }
            </mat-form-field>
          </div>

          <!-- Descrição -->
          <div class="form-group">
            <label class="form-label">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14,2 14,8 20,8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10,9 9,9 8,9"></polyline>
              </svg>
              Descrição Detalhada
            </label>
            <mat-form-field appearance="outline" class="custom-field">
              <textarea
                matInput
                formControlName="descricao"
                rows="6"
                placeholder="Descreva sua solicitação em detalhes para que possamos atendê-lo melhor"
              ></textarea>
              @if (form.get('descricao')?.hasError('required')) {
                <mat-error>Descrição é obrigatória</mat-error>
              }
              @if (form.get('descricao')?.hasError('maxlength')) {
                <mat-error>Máximo de 2000 caracteres</mat-error>
              }
            </mat-form-field>
          </div>

          <!-- Anexos -->
          <div class="anexos-section">
            <div class="section-header">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
              </svg>
              <h3>Anexos</h3>
              <span class="badge-info">Opcional - máximo 3 arquivos</span>
            </div>

            <input
              type="file"
              #fileInput
              (change)="onFileSelected($event)"
              multiple
              accept="image/*,.pdf,.doc,.docx"
              style="display: none"
            />
            
            <button 
              mat-raised-button 
              type="button" 
              class="btn-upload"
              (click)="fileInput.click()" 
              [disabled]="anexos().length >= 3"
            >
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17,8 12,3 7,8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
              Adicionar Arquivo
            </button>

            @if (anexos().length > 0) {
              <div class="anexos-lista">
                @for (anexo of anexos(); track $index) {
                  <div class="anexo-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                      <polyline points="14,2 14,8 20,8"></polyline>
                    </svg>
                    <span>{{ anexo.name }}</span>
                    <button mat-icon-button type="button" class="btn-remove" (click)="removerAnexo($index)">
                      <mat-icon>close</mat-icon>
                    </button>
                  </div>
                }
              </div>
            }
          </div>

          <!-- Actions -->
          <div class="form-actions">
            <button 
              mat-raised-button 
              class="btn-submit" 
              type="submit" 
              [disabled]="!form.valid || enviando()"
            >
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
              </svg>
              @if (enviando()) {
                Enviando...
              } @else {
                Enviar Solicitação
              }
            </button>
          </div>
        </form>
      </div>
    }
  </div>
</div>
